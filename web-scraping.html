<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R para jurimetria</title>
  <meta name="description" content="Template de relatório da ABJ.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="R para jurimetria" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Template de relatório da ABJ." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R para jurimetria" />
  
  <meta name="twitter:description" content="Template de relatório da ABJ." />
  

<meta name="author" content="Associação Brasileira de Jurimetria">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="pacotes-httr-xml2-e-rvest.html">
<link rel="next" href="baixando-dados-do-tjsp.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Apresentação</a></li>
<li class="chapter" data-level="2" data-path="introducao.html"><a href="introducao.html"><i class="fa fa-check"></i><b>2</b> Introdução</a><ul>
<li class="chapter" data-level="2.1" data-path="o-que-e-jurimetria.html"><a href="o-que-e-jurimetria.html"><i class="fa fa-check"></i><b>2.1</b> O que é Jurimetria?</a></li>
<li class="chapter" data-level="2.2" data-path="tipos-de-estudo.html"><a href="tipos-de-estudo.html"><i class="fa fa-check"></i><b>2.2</b> Tipos de estudo</a><ul>
<li class="chapter" data-level="2.2.1" data-path="tipos-de-estudo.html"><a href="tipos-de-estudo.html#exemplo"><i class="fa fa-check"></i><b>2.2.1</b> Exemplo</a></li>
<li class="chapter" data-level="2.2.2" data-path="tipos-de-estudo.html"><a href="tipos-de-estudo.html#divisao-regional"><i class="fa fa-check"></i><b>2.2.2</b> Divisão regional</a></li>
<li class="chapter" data-level="2.2.3" data-path="tipos-de-estudo.html"><a href="tipos-de-estudo.html#qual-tipo-escolher"><i class="fa fa-check"></i><b>2.2.3</b> Qual tipo escolher?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="estudo-1-camaras-criminais.html"><a href="estudo-1-camaras-criminais.html"><i class="fa fa-check"></i><b>2.3</b> Estudo 1: Câmaras criminais</a></li>
<li class="chapter" data-level="2.4" data-path="estudo-2-especializacao-de-varas-empresariais.html"><a href="estudo-2-especializacao-de-varas-empresariais.html"><i class="fa fa-check"></i><b>2.4</b> Estudo 2: Especialização de varas empresariais</a><ul>
<li class="chapter" data-level="2.4.1" data-path="estudo-2-especializacao-de-varas-empresariais.html"><a href="estudo-2-especializacao-de-varas-empresariais.html#contextualizacao"><i class="fa fa-check"></i><b>2.4.1</b> Contextualização</a></li>
<li class="chapter" data-level="2.4.2" data-path="estudo-2-especializacao-de-varas-empresariais.html"><a href="estudo-2-especializacao-de-varas-empresariais.html#desafio-adicional-cifra-oculta"><i class="fa fa-check"></i><b>2.4.2</b> Desafio adicional: cifra oculta</a></li>
<li class="chapter" data-level="2.4.3" data-path="estudo-2-especializacao-de-varas-empresariais.html"><a href="estudo-2-especializacao-de-varas-empresariais.html#voltando-a-complexidade"><i class="fa fa-check"></i><b>2.4.3</b> Voltando à complexidade</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="exemplo-3-captchas.html"><a href="exemplo-3-captchas.html"><i class="fa fa-check"></i><b>2.5</b> Exemplo 3: CAPTCHAs</a></li>
<li class="chapter" data-level="2.6" data-path="cuidado.html"><a href="cuidado.html"><i class="fa fa-check"></i><b>2.6</b> Cuidado</a></li>
<li class="chapter" data-level="2.7" data-path="organizacao-do-curso.html"><a href="organizacao-do-curso.html"><i class="fa fa-check"></i><b>2.7</b> Organização do curso</a></li>
<li class="chapter" data-level="2.8" data-path="configuracao-necessaria-para-o-curso.html"><a href="configuracao-necessaria-para-o-curso.html"><i class="fa fa-check"></i><b>2.8</b> Configuração necessária para o curso</a><ul>
<li class="chapter" data-level="2.8.1" data-path="configuracao-necessaria-para-o-curso.html"><a href="configuracao-necessaria-para-o-curso.html#pacotes"><i class="fa fa-check"></i><b>2.8.1</b> Pacotes</a></li>
<li class="chapter" data-level="2.8.2" data-path="configuracao-necessaria-para-o-curso.html"><a href="configuracao-necessaria-para-o-curso.html#fork-e-upstream-experimental"><i class="fa fa-check"></i><b>2.8.2</b> Fork e upstream (experimental)</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="suas-tarefas-para-1701-demora-30-min.html"><a href="suas-tarefas-para-1701-demora-30-min.html"><i class="fa fa-check"></i><b>2.9</b> Suas tarefas para 17/01 (demora 30 min)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importacao-de-dados.html"><a href="importacao-de-dados.html"><i class="fa fa-check"></i><b>3</b> Importação de dados</a><ul>
<li class="chapter" data-level="3.1" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html"><i class="fa fa-check"></i><b>3.1</b> Pacotes <code>httr</code>, <code>xml2</code> e <code>rvest</code></a><ul>
<li class="chapter" data-level="3.1.1" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#sessoes-e-cookies"><i class="fa fa-check"></i><b>3.1.1</b> Sessões e cookies</a></li>
<li class="chapter" data-level="3.1.2" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#get-e-post"><i class="fa fa-check"></i><b>3.1.2</b> <code>GET</code> e <code>POST</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#outras-funcoes-do-httr"><i class="fa fa-check"></i><b>3.1.3</b> Outras funções do <code>httr</code></a></li>
<li class="chapter" data-level="3.1.4" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#principais-funcoes-do-rvest"><i class="fa fa-check"></i><b>3.1.4</b> Principais funções do <code>rvest</code></a></li>
<li class="chapter" data-level="3.1.5" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#css-path-e-xpath"><i class="fa fa-check"></i><b>3.1.5</b> CSS path e XPath</a></li>
<li class="chapter" data-level="3.1.6" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html#apis-com-httr"><i class="fa fa-check"></i><b>3.1.6</b> APIs com <code>httr</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>3.2</b> Web scraping</a><ul>
<li class="chapter" data-level="3.2.1" data-path="web-scraping.html"><a href="web-scraping.html#informacoes-iniciais"><i class="fa fa-check"></i><b>3.2.1</b> Informações iniciais</a></li>
<li class="chapter" data-level="3.2.2" data-path="web-scraping.html"><a href="web-scraping.html#diferenca-entre-buscar-baixar-e-processar."><i class="fa fa-check"></i><b>3.2.2</b> Diferença entre buscar, baixar e processar.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="baixando-dados-do-tjsp.html"><a href="baixando-dados-do-tjsp.html"><i class="fa fa-check"></i><b>3.3</b> Baixando dados do TJSP</a></li>
<li class="chapter" data-level="3.4" data-path="pacote-esaj.html"><a href="pacote-esaj.html"><i class="fa fa-check"></i><b>3.4</b> Pacote <code>esaj</code></a><ul>
<li class="chapter" data-level="3.4.1" data-path="pacote-esaj.html"><a href="pacote-esaj.html#download-esaj"><i class="fa fa-check"></i><b>3.4.1</b> Download esaj</a></li>
<li class="chapter" data-level="3.4.2" data-path="pacote-esaj.html"><a href="pacote-esaj.html#parse-esaj"><i class="fa fa-check"></i><b>3.4.2</b> Parse esaj</a></li>
<li class="chapter" data-level="3.4.3" data-path="pacote-esaj.html"><a href="pacote-esaj.html#download-cposg"><i class="fa fa-check"></i><b>3.4.3</b> Download CPOSG</a></li>
<li class="chapter" data-level="3.4.4" data-path="pacote-esaj.html"><a href="pacote-esaj.html#parse-cposg"><i class="fa fa-check"></i><b>3.4.4</b> Parse CPOSG</a></li>
<li class="chapter" data-level="3.4.5" data-path="pacote-esaj.html"><a href="pacote-esaj.html#download-docs"><i class="fa fa-check"></i><b>3.4.5</b> Download docs</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="pacote-dje.html"><a href="pacote-dje.html"><i class="fa fa-check"></i><b>3.5</b> Pacote <code>dje</code></a><ul>
<li class="chapter" data-level="3.5.1" data-path="pacote-dje.html"><a href="pacote-dje.html#download-dje"><i class="fa fa-check"></i><b>3.5.1</b> Download DJE</a></li>
<li class="chapter" data-level="3.5.2" data-path="pacote-dje.html"><a href="pacote-dje.html#parse-dje"><i class="fa fa-check"></i><b>3.5.2</b> Parse DJE</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="pacote-abjutils.html"><a href="pacote-abjutils.html"><i class="fa fa-check"></i><b>3.6</b> Pacote <code>abjutils</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="work-in-progress.html"><a href="work-in-progress.html"><i class="fa fa-check"></i><b>4</b> Work in progress</a></li>
<li class="chapter" data-level="5" data-path="work-in-progress-1.html"><a href="work-in-progress-1.html"><i class="fa fa-check"></i><b>5</b> Work in progress</a></li>
<li class="chapter" data-level="6" data-path="work-in-progress-2.html"><a href="work-in-progress-2.html"><i class="fa fa-check"></i><b>6</b> Work in progress</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R para jurimetria</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="web-scraping" class="section level2">
<h2><span class="header-section-number">3.2</span> Web scraping</h2>
<p>Esta seção contém algumas melhores práticas na contrução de ferramentas no R que baixam e processam informações de sites disponíveis na web. O objetivo é ajudar o jurimetrista a desenvolver programas que sejam fáceis de adaptar no tempo.</p>
<p>É importante ressaltar que só estamos trabalhando com páginas que são acessíveis publicamente. Caso tenha interesse e “raspar” páginas que precisam de autenticação, recomendamos que estude os termos de uso do site.</p>
<p>Para ilustrar este texto, usaremos como exemplo o código utilizado no trabalho das câmaras, que acessa o site do Tribunal de Justiça de São Paulo para obter informações de processos judiciais. Trabalharemos principalmente com a <a href="https://esaj.tjsp.jus.br/cjsg/consultaCompleta.do">Consulta de Jurisprudência</a> e a <a href="https://esaj.tjsp.jus.br/cpo/sg/open.do">Consulta de de Processos de Segundo Grau</a> do TJSP.</p>
<div id="informacoes-iniciais" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Informações iniciais</h3>
<p>Antes de iniciar um programa de web scraping, verifique se existe alguma forma mais fácil de conseguir os dados que necessita. Construir um web scraper do zero é muitas vezes uma tarefa dolorosa e, caso o site seja atualizado, pode ser que boa parte do trabalho seja inútil. Se os dados precisarem ser extraídos apenas uma vez, verifique com os responsáveis pela manutenção do site se eles podem fazer a extração que precisa. Se os dados precisarem ser atualizados, verifique se a entidade não possui uma API para acesso aos dados.</p>
<p>Ao escrever um web scraper, as primeiras coisas que devemos pensar são</p>
<ul>
<li>Como o site a ser acessado foi contruído, se tem limites de requisições, utilização de cookies, states, etc.</li>
<li>Como e com que frequência o site é atualizado, tanto em relação à sua interface como em relação aos dados que queremos extrair.</li>
<li>Como conseguir a lista das páginas que queremos acessar.</li>
<li>Qual o caminho percorrido para acessar uma página específica.</li>
</ul>
<p>Sugerimos como melhores práticas dividir todas as atividades em três tarefas principais: i) <em>buscar</em>; ii) <em>coletar</em> e iii) <em>processar</em>. Quando já sabemos de antemão quais são as URLs que vamos acessar, a etapa de busca é desnecessária.</p>
<p>Na maior parte dos casos, deixar os algoritmos de <em>coleta</em> e <em>processamento</em> dos dados em funções distintas é uma boa prática pois aumenta o controle sobre o que as ferramentas estão fazendo, facilita o debug e a atualização. Por outro lado, em alguns casos isso pode tornar o código mais ineficiente e os arquivos obtidos podem ficar pesados.</p>
</div>
<div id="diferenca-entre-buscar-baixar-e-processar." class="section level3">
<h3><span class="header-section-number">3.2.2</span> Diferença entre buscar, baixar e processar.</h3>
<p>Buscar documentos significa, de uma forma geral, utilizar ferramentas de busca (ou acessar links de um site) para obter informações de uma nova requisição a ser realizada. Ou seja, essa etapa do scraper serve para “procurar links” que não sabíamos que existiam previamente. Isso será resolvido através da função <code>esaj::download_cjsg()</code>.</p>
<p>Baixar documentos, no entando, significa simplesmente acessar páginas pré-estabelecidas e salvá-las em disco. Em algumas situações, os documentos baixados (depois de limpos) podem conter uma nova lista de páginas a serem baixadas, formando iterações de coletas. A tarefa de baixar documentos pré-estabelecidos será realizada pelas funções <code>esaj::download_cposg()</code> e <code>dje::download_dje()</code>.</p>
<p>Finalmente, processar documentos significa carregar dados acessíveis em disco e transformar os dados brutos uma base <em>tidy</em>. Usualmente separamos a estruturação em duas etapas: i) transformar arquivos não-estruturados em um arquivos semi-estruturados (e.g. um arquivo HTML em uma tabela mais um conjunto de textos livres) e ii) transformar arquivos semi-estruturados em uma base analítica (estruturada). A tarefa de processar as páginas HTML será realizada pelas funções <code>esaj::parse_cjsg()</code> e <code>esaj::run_parser()</code>.</p>
<p>Na pesquisa das câmaras, o fluxo é</p>
<pre><code>buscar -&gt; coletar -&gt; processar -&gt; coletar -&gt; processar</code></pre>
<p>Na pesquisa da especialização, o fluxo é</p>
<pre><code>coletar -&gt; processar -&gt; coletar -&gt; processar</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pacotes-httr-xml2-e-rvest.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="baixando-dados-do-tjsp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/02-import.Rmd",
"text": "Edit"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
